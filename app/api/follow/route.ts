import { NextResponse,getRequestContext } from "next/server"; export const runtime="edge";
export async function POST(req:Request){try{const db=(getRequestContext() as any).env.DB as any;const body=await req.json();const {follower_id,following_id,action}=body;if(!follower_id||!following_id||!action)return NextResponse.json({ok:false,error:"missing fields"});if(action==="follow"){await db.prepare("INSERT INTO follows (follower_id,following_id) VALUES (?,?)").bind(follower_id,following_id).run();return NextResponse.json({ok:true,action:"follow"});}else if(action==="unfollow"){await db.prepare("DELETE FROM follows WHERE follower_id=? AND following_id=?").bind(follower_id,following_id).run();return NextResponse.json({ok:true,action:"unfollow"});}else{return NextResponse.json({ok:false,error:"invalid action"});}}catch(e:any){console.error("/api/follow",e);return NextResponse.json({ok:false,error:e.message??String(e)},{status:500});}}