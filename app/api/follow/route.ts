import { NextResponse } from "next/server";
import { getRequestContext } from "@cloudflare/next-on-pages";
export const runtime="edge";
export async function POST(req:Request){try{const env=getRequestContext().env as any;const db=env.DB;const { follower_id, following_id, action }=await req.json();if(!follower_id||!following_id||!action)return NextResponse.json({ok:false,error:"missing fields"},{status:400});if(action==="follow"){await db.prepare("INSERT OR IGNORE INTO follows (follower_id,following_id) VALUES (?,?)").bind(follower_id,following_id).run();return NextResponse.json({ok:true,action:"follow"})}if(action==="unfollow"){await db.prepare("DELETE FROM follows WHERE follower_id=? AND following_id=?").bind(follower_id,following_id).run();return NextResponse.json({ok:true,action:"unfollow"})}return NextResponse.json({ok:false,error:"invalid action"},{status:400})}catch(e:any){console.error("API /follow:",e);return NextResponse.json({ok:false,error:e?.message??String(e)},{status:500})}}
